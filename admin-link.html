<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Link | Astro Kabuto</title>
  <style>
    body{font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif; margin:24px; line-height:1.7;}
    input{width:min(720px,100%); height:44px; padding:0 12px; border:1px solid #ccc; border-radius:10px;}
    button{height:44px; padding:0 14px; border-radius:10px; border:1px solid #ccc; cursor:pointer;}
    .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:12px;}
    a{word-break:break-all;}
    .muted{color:#666; font-size:13px;}
    code{background:#f3f3f3; padding:2px 6px; border-radius:6px;}
  </style>
</head>
<body>
  <h1>Admin URL 生成</h1>
  <p class="muted">ADMIN_TOKEN を貼ると、安全にエンコードした admin URL を作ります（<code>&lt;&gt;</code>不要）。</p>

  <div class="row">
    <input id="token" placeholder="ADMIN_TOKEN を貼る（< >なし）" />
    <button id="make">作る</button>
    <button id="open" disabled>開く</button>
    <button id="copy" disabled>コピー</button>
  </div>

  <p id="out" class="muted"></p>
  <p><a id="link" href="#" target="_blank" rel="noopener" style="display:none;"></a></p>

  <script>
    // ★ここだけあなたのworkers.devに合わせて固定する
    const ORIGIN = "https://astro-kabuto-gallery-worker.gigasantrinn1226.workers.dev";

    const tokenEl = document.getElementById("token");
    const out = document.getElementById("out");
    const link = document.getElementById("link");
    const btnMake = document.getElementById("make");
    const btnOpen = document.getElementById("open");
    const btnCopy = document.getElementById("copy");

    function build() {
      const t = tokenEl.value.trim();
      if (!t) {
        out.textContent = "トークンを入れてください";
        link.style.display = "none";
        btnOpen.disabled = true;
        btnCopy.disabled = true;
        return;
      }
      const url = `${ORIGIN}/admin?token=${encodeURIComponent(t)}`;
      out.textContent = "生成OK";
      link.textContent = url;
      link.href = url;
      link.style.display = "inline";
      btnOpen.disabled = false;
      btnCopy.disabled = false;
      return url;
    }

    btnMake.addEventListener("click", build);

    btnOpen.addEventListener("click", () => {
      const url = build();
      if (url) window.open(url, "_blank", "noopener");
    });

    btnCopy.addEventListener("click", async () => {
      const url = build();
      if (!url) return;
      await navigator.clipboard.writeText(url);
      out.textContent = "コピーしました";
    });
  </script>
</body>
</html>
